<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Can We Pour Today? • Yorktown Tools</title>
    <link rel="icon" href="Yorktown.PNG">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --navy: #0b1e3f;
            --red: #c8102e;
            --green: #2e7d32;
            --yellow: #b07100;
            --light: #f8f9fa;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: #fff;
            color: #1a1a1a;
            line-height: 1.6;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
        }
        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background: url('george-mascot.PNG') center / contain no-repeat;
            opacity: 0.07;
            pointer-events: none;
            z-index: -1;
        }

        /* 1. New scrolling banner with live update time */
        .ticker {
            background: var(--red);
            color: white;
            padding: 0.9rem 1rem;
            font-weight: 800;
            font-size: 1.25rem;
            overflow: hidden;
            white-space: nowrap;
            position: relative;
        }
        .ticker span {
            display: inline-block;
            padding-left: 100%;
            animation: scroll 35s linear infinite;
        }
        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        .gov {
            background: var(--navy);
            color: white;
            text-align: center;
            padding: 0.5rem;
            font-size: 0.95rem;
        }
        .gov strong { color: #ffeb3b; }

        .logo { text-align: center; padding: 2rem 1rem 1rem; }
        .logo img { max-width: 280px; width: 90%; height: auto; }

        main { flex: 1; max-width: 1100px; margin: 0 auto; padding: 1rem 1.5rem 4rem; }

        h1 {
            font-size: clamp(2.8rem, 8vw, 4.8rem);
            font-weight: 900;
            color: var(--navy);
            text-align: center;
            margin: 1rem 0 0.5rem;
        }
        .tagline {
            text-align: center;
            font-size: 1.4rem;
            color: #444;
            margin-bottom: 2.5rem;
        }

        /* Concrete photo section */
        .concrete-photo {
            text-align: center;
            margin: 3rem 0;
        }
        .concrete-photo img {
            max-width: 100%;
            height: auto;
            border-radius: 16px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .big-light {
            width: 260px; height: 260px; border-radius: 50%;
            margin: 2rem auto; display: grid; place-items: center;
            font-size: 160px; box-shadow: 0 30px 70px rgba(0,0,0,0.3);
            transition: all 0.6s ease;
        }
        .green { background: #4CAF50; color: white; }
        .yellow { background: #FFCA28; color: #000; }
        .red { background: #D32F2F; color: white; }

        .verdict {
            font-size: clamp(2.2rem, 7vw, 3.4rem);
            font-weight: 900;
            text-align: center;
            margin: 1.5rem 0;
        }
        .explanation {
            background: var(--light);
            border-radius: 16px;
            padding: 1.8rem;
            margin: 2.5rem auto;
            max-width: 800px;
            font-size: 1.15rem;
            line-height: 1.7;
            border-left: 6px solid var(--red);
        }
        .explanation strong { color: var(--navy); }

        /* 3. City cards – red outline + darker look */
        .cities {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 4rem 0;
        }
        .city-card {
            background: #1a1a1a;
            color: white;
            padding: 1.6rem 1.2rem;
            border-radius: 12px;
            border: 3px solid var(--red);
            box-shadow: 0 10px 30px rgba(200,16,46,0.25);
            text-align: center;
            font-weight: 700;
            font-size: 1.35rem;
        }
        .city-name { font-size: 1.1rem; color: #ccc; margin-bottom: 0.6rem; }
        .go { color: var(--green); }
        .caution { color: var(--yellow); }
        .no { color: #ff5252; }
        .city-card small { display: block; margin-top: 0.8rem; font-size: 0.9rem; opacity: 0.9; }

        /* 4. Smaller footer, no big phone button */
        footer {
            background: var(--navy);
            color: #ddd;
            padding: 3rem 1.5rem 2rem;
            text-align: center;
            font-size: 1.1rem;
        }
        footer strong { font-size: 1.6rem; display: block; margin-bottom: 0.4rem; color: white; }
        footer a { color: var(--red); text-decoration: none; font-weight: 700; }

        .fab {
            position: fixed;
            right: clamp(16px, 4vw, 28px);
            bottom: clamp(16px, 4vw, 28px);
            width: clamp(70px, 16vw, 92px);
            height: clamp(70px, 16vw, 92px);
            background: var(--red);
            border-radius: 50%;
            display: grid;
            place-items: center;
            box-shadow: 0 12px 40px rgba(200,16,46,0.6);
            z-index: 1000;
            animation: pulse 2.8s infinite;
        }
        .fab img { width: 68%; border: 4px solid white; border-radius: 50%; }
        @keyframes pulse {
            0%,100% { box-shadow: 0 12px 40px rgba(200,16,46,0.6); }
            70% { box-shadow: 0 16px 60px rgba(200,16,46,0.9); }
        }

        .loading { opacity: 0.6; }
        .error { color: #ff5252; font-style: italic; }

        @media (max-width: 640px) {
            .big-light { width: 200px; height: 200px; font-size: 120px; }
            .explanation { padding: 1.4rem; font-size: 1.05rem; }
            .ticker { font-size: 1.1rem; }
        }
    </style>
</head>
<body>

<a href="tel:757-940-5171" class="fab" aria-label="Call Yorktown Tools">
    <img src="Yorktown.PNG" alt="Call">
</a>

<!-- 1. New scrolling ticker with live update time -->
<div class="ticker">
    <span id="tickerText">Can We Pour Concrete Today? • Live NOAA/NWS Forecast • Last updated: <span id="liveTime">Never</span></span>
</div>

<div class="gov"><strong>UEI:</strong> SMYXDLJDJDJMZ4 | <strong>CAGE:</strong> 16LD9 | Veteran-Owned</div>
<div class="logo"><img src="Yorktown.PNG" alt="Yorktown Tools"></div>

<main>
    <h1>Can We Pour Today?</h1>
    <p class="tagline">Richmond to Virginia Beach — updated every 15 minutes from NOAA</p>

    <!-- 5. Concrete photo section – replace concrete.jpg with your own image -->
    <div class="concrete-photo">
        <img src="concrete.jpg" alt="Fresh concrete pour in progress">
    </div>

    <div class="big-light green loading" id="light">Green Circle</div>
    <div class="verdict green loading" id="verdict">Loading live data...</div>

    <div class="explanation" id="explanation">
        <strong>How we decide (based on ACI guidelines):</strong><br>
        We pull live NOAA/NWS data and check the next 8 hours for:
        <ul style="margin-top:0.8rem; text-align:left; max-width:600px; margin-left:auto; margin-right:auto;">
            <li>Rain probability &gt; 30% → <span style="color:#c62828;font-weight:800">NO-GO</span></li>
            <li>Temperature &lt; 40°F or &gt; 90°F → <span style="color:#b07100;font-weight:800">CAUTION</span> (use special mixes)</li>
            <li>Wind gusts &gt; 20 mph → <span style="color:#b07100;font-weight:800">CAUTION</span></li>
            <li>Everything else → <span style="color:#2e7d32;font-weight:800">GOOD TO POUR</span></li>
        </ul>
        <small id="lastUpdate" style="display:block; margin-top:1rem; color:#666;">Last updated: Never</small>
    </div>

    <div class="cities loading" id="cities">
        <div class="city-card">Fetching live NOAA data...</div>
    </div>

    <!-- 4. Smaller footer without giant button -->
    <footer>
        <strong>Yorktown Tools</strong><br>
        Never Run Out. Never Overpay.<br>
        Premium concrete tools &amp; rebar delivered FREE — same day.<br><br>
        <a href="tel:757-940-5171">757-940-5171</a> • Call or Text Anytime
    </footer>
</main>

<script>
    const locations = [
        { name: "Richmond", lat: 37.5407, lng: -77.4360 },
        { name: "Williamsburg", lat: 37.2707, lng: -76.7075 },
        { name: "Yorktown", lat: 37.2394, lng: -76.5041 },
        { name: "Newport News", lat: 37.0871, lng: -76.4730 },
        { name: "Hampton", lat: 37.0299, lng: -76.3452 },
        { name: "Norfolk", lat: 36.8508, lng: -76.2852 },
        { name: "Virginia Beach", lat: 36.8529, lng: -75.9780 }
    ];

    const light = document.getElementById('light');
    const verdict = document.getElementById('verdict');
    const citiesContainer = document.getElementById('cities');
    const lastUpdate = document.getElementById('lastUpdate');
    const liveTime = document.getElementById('liveTime');

    async function fetchForecast(lat, lng) {
        try {
            const pointResponse = await fetch(`https://api.weather.gov/points/${lat},${lng}`, {
                headers: { 'User-Agent': 'YorktownToolsPourChecker (contact@yorktowntools.com)' }
            });
            if (!pointResponse.ok) throw new Error('Point fetch failed');
            const pointData = await pointResponse.json();
            const forecastUrl = pointData.properties.forecast;
            const forecastResponse = await fetch(forecastUrl, {
                headers: { 'User-Agent': 'YorktownToolsPourChecker (contact@yorktowntools.com)' }
            });
            if (!forecastResponse.ok) throw new Error('Forecast fetch failed');
            const forecastData = await forecastResponse.json();
            const periods = forecastData.properties.periods;
            const now = new Date();
            const next8Hours = now.getTime() + (8 * 60 * 60 * 1000);
            const relevantPeriods = periods.filter(p => {
                const startTime = new Date(p.startTime).getTime();
                return startTime >= now.getTime() && startTime <= next8Hours;
            });
            const maxRain = Math.max(...relevantPeriods.map(p => p.probabilityOfPrecipitation?.value || 0));
            const temps = relevantPeriods.map(p => p.temperature);
            const minTemp = Math.min(...temps);
            const maxTemp = Math.max(...temps);
            const windSpeeds = relevantPeriods.map(p => parseInt(p.windSpeed?.split(' ')[0]) || 0);
            const maxWind = Math.max(...windSpeeds);
            return { maxRain, minTemp, maxTemp, maxWind, periods: relevantPeriods };
        } catch (error) {
            console.error(`Error fetching for ${lat},${lng}:`, error);
            return { error: true, maxRain: 0, minTemp: 50, maxTemp: 70, maxWind: 10 };
        }
    }

    function assessStatus({ maxRain, minTemp, maxTemp, maxWind }) {
        let issues = [];
        if (maxRain > 30) issues.push('Rain >30%');
        if (minTemp < 40 || maxTemp > 90) issues.push('Temp extreme');
        if (maxWind > 20) issues.push('High wind');
        if (issues.length >= 2) return { status: 'no', text: 'Do Not Pour', issues };
        if (issues.length === 1) return { status: 'caution', text: 'Use Caution', issues };
        return { status: 'go', text: 'Good to Pour', issues: [] };
    }

    function updateUI() {
        const promises = locations.map(async (loc) => {
            const data = await fetchForecast(loc.lat, loc.lng);
            const status = assessStatus(data);
            return { ...loc, ...data, ...status };
        });

        Promise.all(promises).then(locationsData => {
            const hasNo = locationsData.some(d => d.status === 'no');
            const hasCaution = locationsData.some(d => d.status === 'caution');
            const overallStatus = hasNo ? 'no' : (hasCaution ? 'caution' : 'go');
            const overallText = hasNo ? 'NO — HOLD THE POUR' : (hasCaution ? 'CAUTION — Check Conditions' : 'YES — POUR WITH CONFIDENCE');

            light.className = `big-light ${overallStatus}`;
            light.innerHTML = overallStatus === 'go' ? 'Green Circle' : (overallStatus === 'caution' ? 'Yellow Circle' : 'Red Circle');
            verdict.textContent = overallText;
            verdict.className = `verdict ${overallStatus}`;
            verdict.style.color = overallStatus === 'go' ? '#2e7d32' : (overallStatus === 'caution' ? '#b07100' : '#c62828');

            citiesContainer.innerHTML = locationsData.map(loc => `
                <div class="city-card">
                    <div class="city-name">${loc.name}</div>
                    <div class="${loc.status}">${loc.text}</div>
                    <small>${loc.minTemp}°–${loc.maxTemp}°F • ${loc.maxRain}% rain • ${loc.maxWind} mph wind</small>
                    ${loc.issues.length ? `<div style="font-size:0.9rem;margin-top:0.5rem;"><strong>Issues:</strong> ${loc.issues.join(', ')}</div>` : ''}
                </div>
            `).join('');

            const now = new Date().toLocaleString();
            lastUpdate.textContent = `Last updated: ${now}`;
            liveTime.textContent = now;   // Updates the scrolling ticker too
        }).catch(error => {
            citiesContainer.innerHTML = '<div class="city-card error">Error loading data. Please refresh.</div>';
            console.error('Update failed:', error);
        });

        document.body.classList.remove('loading');
    }

    // Initial load
    updateUI();
    setInterval(updateUI, 15 * 60 * 1000);
</script>
</body>
</html>
